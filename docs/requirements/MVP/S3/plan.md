# Phase S3 Implementation Plan: Visual Enhancements & Polish

## 1. Executive Summary
Phase S3 focuses on enriching the visual capability and user experience of the blog. We will integrate Mermaid.js for diagrams and a Lightbox solution for better image viewing, while also ensuring the site looks great on mobile devices and loads efficiently.

## 2. Objectives
- **Diagram Support**: Enable rendering of flowcharts, sequence diagrams, etc., using Mermaid.js.
- **Image UX**: Implement "click-to-zoom" functionality for images (Lightbox).
- **Mobile Adaptation**: Refine responsive layouts for smaller screens.
- **Performance**: Optimize asset loading (lazy loading).

## 3. Architecture & Design

### 3.1 Technical Components
- **Mermaid.js**:
  - Load via CDN (esm) or local script to render `.mermaid` code blocks.
  - **Strategy**: Since Mermaid is large, we will load it only if the page contains mermaid blocks, or lazily. For MVP simplicity, we might load it globally but defer execution.
- **Image Lightbox**:
  - Library: `medium-zoom` (lightweight, zero dependency).
  - **Integration**: Auto-apply to all images within `.article`.

### 3.2 Responsive Enhancements
- **Sidebar**: Ensure the "collapsed" mobile view works smoothly.
- **Content**: Ensure code blocks and diagrams do not break horizontal layout on small screens (overflow handling).
- **Images**: Ensure max-width constraints work with the lightbox.

## 4. Implementation Steps

### Step 1: Library Acquisition
- **Action**: Download/Setup libraries.
  - `js/mermaid.min.js` (or use ESM from CDN if preferred, but local `min.js` is safer for "static" requirement).
  - `js/medium-zoom.min.js`.
- **Validation**: Ensure files are present in `js/`.

### Step 2: Mermaid Integration
- **Action**: Update `js/app.js` -> `initRichContent()`.
  - logic: Find code blocks with language `mermaid`.
  - logic: Convert them to `<div class="mermaid">` so Mermaid.js can pick them up.
  - logic: Call `mermaid.init()`.

### Step 3: Lightbox Integration
- **Action**: Update `js/app.js` -> `initRichContent()`.
  - logic: Initialize `mediumZoom('.article img')`.
  - **Style**: Add basic CSS if needed (though medium-zoom injects its own overlay styles).

### Step 4: Responsive & UI Polish
- **Action**: Audit `css/style.css`.
  - Add `overflow-x: auto` to `.mermaid` containers.
  - Verify Sidebar hamburger/collapse behavior on mobile (currently CSS-only `media` query, might need JS toggle for better UX).
  - **Optimization**: Add `loading="lazy"` to image tags generated by the markdown renderer (via a marked extension or post-processing).

### Step 5: Performance Tuning
- **Action**: Defer non-critical scripts.
- **Action**: Ensure fonts are efficient.

## 5. Risk Assessment
- **Risk**: Mermaid.js size is significant (~1MB uncompressed).
  - *Mitigation*: Use `defer` attribute.
- **Risk**: Mermaid conflicts with Markdown code block parsing.
  - *Mitigation*: Ensure the `mermaid` class is correctly applied *before* Prism tries to highlight it (or disable Prism for mermaid blocks).

## 6. Success Criteria
- [ ] Mermaid diagrams render correctly in `test-rich-content.md`.
- [ ] Clicking an image smoothly zooms it to full screen.
- [ ] Mobile view navigation is usable (sidebar doesn't block content).
- [ ] Lighthouse performance score > 90.
